Ext.data.JsonP.push({"guide":"<h1 id='push-section-walkthrough%3A-mobile-services-push-example'>Walkthrough: Mobile Services Push example</h1>\n<div class='toc'>\n<p><strong>Contents</strong></p>\n<ol>\n<li><a href='#!/guide/push-section-app.js'>app.js</a></li>\n<li><a href='#!/guide/push-section-windows-azure-data-table-for-storage'>Windows Azure Data Table for Storage</a></li>\n<li><a href='#!/guide/push-section-how-push-notifications-are-sent'>How Push Notifications are sent</a></li>\n</ol>\n</div>\n\n<p>The Push sample application is an example building on the simpler <a href=\"#!/example/Basic\">Basic</a> demo.\nYou can view the full source code in the download package by opening the /examples/push folder.</p>\n\n<p>Be sure you have read and fully understand the <a href=\"#!/guide/data_basic\">Basic walkthrough</a> before continuing with this guide.</p>\n\n<h2 id='push-section-app.js'>app.js</h2>\n\n<p>In order to use Push in your application, you'll need to configure the Push section of your Azure Mobile Service. For more info see the <a href=\"#!/guide/mobile_services_push-section-1\">Push Notifications Guide</a>.</p>\n\n<p>Once you have configured your Mobile Service with the desired Push registrations, you will need to add the <strong>pushConfig</strong> config to your <em>azure</em> object:</p>\n\n<pre><code>Ext.application({\n\n    //...\n\n        azure : {\n\n            appKey: 'YOUR-APP-KEY',\n            appUrl: 'YOUR-APP-URL',\n\n            pushConfig: {\n                windowsphone : 'channel_name',\n                android      : 'sender_id'\n                ios          : true\n            }\n        },\n\n    //...\n\n});\n</code></pre>\n\n<h2 id='push-section-windows-azure-data-table-for-storage'>Windows Azure Data Table for Storage</h2>\n\n<p>To run the Push Notification sample application, your Azure mobile service should use two data tables:</p>\n\n<ul>\n<li>TodoItem</li>\n<li>Devices</li>\n</ul>\n\n\n<p>After you have created these tables in the Windows Azure portal, update the <strong>INSERT</strong> script for the <strong>TodoItem</strong> table with the following:</p>\n\n<pre><code>function insert(item, user, request) {\n\n    var devicesTable = tables.getTable('Devices');\n\n    // execute the request\n    request.execute({\n        success: function() {\n            request.respond();\n            sendNotifications();\n        }\n    });\n\n    function sendNotifications() {\n\n        devicesTable.read({\n            success: function(devices) {\n\n                devices.forEach(function(device) {\n\n                    // Android\n                    if (device.platform == \"Android\") {\n                        console.log('Android Push to registrationId ' + device.token);\n                        push.gcm.send(device.token, item.text, {\n                            success: function(response) {\n                               console.log('SUCCESS sending Android Push notification: ', response);\n                            },\n                            error: function(error) {\n                                console.log('ERROR sending Android Push notification: ', error);\n                            }\n                        });\n                    }\n\n                    // iOS\n                    if (device.platform == \"iOS\") {\n                        console.log('iOS Push to deviceToken ' + device.token);\n                        push.apns.send(device.token, {\n                            alert: \"Toast: \" + item.text,\n                            payload: {\n                                inAppMessage: \"Hey, a new item arrived: \" + item.text\n                            },\n                        }, {\n                            success: function(response) {\n                                console.log('SUCCESS sending iOS Push notification: ', response);\n                            },\n                            error: function(error) {\n                                console.log('ERROR sending iOS Push notification: ', error);\n                            }\n                        });\n                    }\n\n                    // WP8\n                    if (device.platform == \"WindowsPhone\") {\n                        console.log('WindowsPhone Push to channel ' + device.token);\n                        push.mpns.sendToast(device.token, {\n                            text1: item.text,\n                            text2: item.text\n                        }, {\n                            success: function (response) {\n                                console.log('SUCCESS sending WP Toast Push notification: ', response);\n                            },\n                            error: function(error) {\n                                console.log('ERROR sending WP Toast Push notification: ', error);\n                            }\n                        });\n                        push.mpns.sendFlipTile(device.token, {\n                            title: item.text\n                        }, {\n                            success: function (response) {\n                                console.log('SUCCESS sending WP Flip Tile Push notification: ', response);\n                            },\n                            error: function(error) {\n                                console.log('ERROR sending WP Flip Tile Push notification: ', error);\n                            }\n                        });\n                    }\n                });\n\n            },\n            error: function(error) {\n                console.log('ERROR reading Devices table: ', error);\n            }\n        });\n    }\n\n}\n</code></pre>\n\n<p>Next, update the <strong>INSERT</strong> script for the <strong>Devices</strong> table with the following:</p>\n\n<pre><code>function insert(item, user, request) {\n  var devices = tables.getTable('Devices');\n\n  devices\n      .where({\n          token: item.token\n      })\n      .read({\n          success: insertDeviceIfNotFound\n      });\n\n  function insertDeviceIfNotFound(existingDevices) {\n      if (existingDevices.length &gt; 0) {\n          console.log(\"Device Token already exists for token \" + existingDevices[0]);\n          request.respond(200, existingDevices[0]);\n      } else {\n          console.log(\"Adding device Token \" + item.token);\n          request.execute();\n      }\n  }\n}\n</code></pre>\n\n<h2 id='push-section-how-push-notifications-are-sent'>How Push Notifications are sent</h2>\n\n<p>Push notifications are done from the insert script of the TodoItem table.  Since each platform has its own API for sending notifications, the script checks to see which platform is stored for the token in the Devices table and then the appropriate API is called.</p>\n\n<p>For more information on each platforms Push API refer to the following:</p>\n\n<ul>\n<li>iOS - Use the <a href=\"http://msdn.microsoft.com/en-us/library/windowsazure/jj839711.aspx\">Apple Push Notification Service (APNS)</a></li>\n<li>Android - Use the <a href=\"http://msdn.microsoft.com/en-us/library/windowsazure/dn126137.aspx\">Google Cloud Messaging (GCM)</a></li>\n<li>Windows Phone - Use the <a href=\"http://msdn.microsoft.com/en-us/library/windowsazure/jj871025.aspx\">Microsoft Push Notification Service (MPNS)</a></li>\n</ul>\n\n","title":"Mobile Services: Push Notifications"});